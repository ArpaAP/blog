---
import { getCollection } from 'astro:content';

const posts = await getCollection('articles');
const tags = posts.flatMap(post => post.data.tags || []);
const uniqueTags = [...new Set(tags)];

const tagCounts = uniqueTags.map(tag => {
  const count = tags.filter(t => t === tag).length;
  return {
    name: tag,
    slug: tag, // Simple slug for now, strictly speaking should be slugified
    count
  };
}).sort((a, b) => b.count - a.count);

const { currentTag } = Astro.props;
---

<aside class="w-full md:w-64 shrink-0">
  <div class="sticky top-24">
    <h3 class="font-bold text-gray-900 dark:text-gray-100 mb-4 tracking-wide text-sm uppercase">카테고리</h3>
    <ul class="space-y-2">
      <li>
        <a 
          href="/articles" 
          class:list={[
            "flex justify-between items-center group px-3 py-2 rounded-lg transition-colors text-sm",
            !currentTag ? "bg-brand-50 dark:bg-brand-900/20 text-brand-700 dark:text-brand-300 font-medium" : "text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-gray-200"
          ]}
        >
          <span>전체글</span>
        </a>
      </li>
      {tagCounts.map((tag) => (
        <li>
          <a 
            href={`/articles/tag/${tag.slug}`}
            class:list={[
              "flex justify-between items-center group px-3 py-2 rounded-lg transition-colors text-sm",
              currentTag === tag.slug ? "bg-brand-50 dark:bg-brand-900/20 text-brand-700 dark:text-brand-300 font-medium" : "text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-gray-200"
            ]}
          >
            <span>{tag.name}</span>
            <span class="text-xs text-gray-400 bg-gray-50 dark:bg-white/7 group-hover:bg-white dark:group-hover:bg-white/5 px-2 py-0.5 rounded-full transition-colors">
              {tag.count}
            </span>
          </a>
        </li>
      ))}
    </ul>
  </div>
</aside>
